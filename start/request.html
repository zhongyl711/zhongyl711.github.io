<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>请求 | Ynet-H5平台框架</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Ynet-H5平台框架">
    
    <link rel="preload" href="/docs/assets/css/0.styles.94ae1aad.css" as="style"><link rel="preload" href="/docs/assets/js/app.a8b6816f.js" as="script"><link rel="preload" href="/docs/assets/js/2.9a338741.js" as="script"><link rel="preload" href="/docs/assets/js/36.75323e51.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.84fb6d19.js"><link rel="prefetch" href="/docs/assets/js/11.598658e3.js"><link rel="prefetch" href="/docs/assets/js/12.970d0a49.js"><link rel="prefetch" href="/docs/assets/js/13.a1286195.js"><link rel="prefetch" href="/docs/assets/js/14.a19b6384.js"><link rel="prefetch" href="/docs/assets/js/15.54760aa1.js"><link rel="prefetch" href="/docs/assets/js/16.441bb57c.js"><link rel="prefetch" href="/docs/assets/js/17.8ef0c638.js"><link rel="prefetch" href="/docs/assets/js/18.62607bbf.js"><link rel="prefetch" href="/docs/assets/js/19.d209ac59.js"><link rel="prefetch" href="/docs/assets/js/20.84a44669.js"><link rel="prefetch" href="/docs/assets/js/21.95d79d29.js"><link rel="prefetch" href="/docs/assets/js/22.95e4b0d8.js"><link rel="prefetch" href="/docs/assets/js/23.5a4dd687.js"><link rel="prefetch" href="/docs/assets/js/24.0c18cac9.js"><link rel="prefetch" href="/docs/assets/js/25.40d8ba0d.js"><link rel="prefetch" href="/docs/assets/js/26.3d572dbc.js"><link rel="prefetch" href="/docs/assets/js/27.299b040d.js"><link rel="prefetch" href="/docs/assets/js/28.61546b37.js"><link rel="prefetch" href="/docs/assets/js/29.faad5132.js"><link rel="prefetch" href="/docs/assets/js/3.eb09cc22.js"><link rel="prefetch" href="/docs/assets/js/30.d7e3d7ca.js"><link rel="prefetch" href="/docs/assets/js/31.caa1a650.js"><link rel="prefetch" href="/docs/assets/js/32.c0a156ae.js"><link rel="prefetch" href="/docs/assets/js/33.de5c0526.js"><link rel="prefetch" href="/docs/assets/js/34.e658f871.js"><link rel="prefetch" href="/docs/assets/js/35.383b270a.js"><link rel="prefetch" href="/docs/assets/js/4.fad0cf3e.js"><link rel="prefetch" href="/docs/assets/js/5.edc7a992.js"><link rel="prefetch" href="/docs/assets/js/6.91e0bcc4.js"><link rel="prefetch" href="/docs/assets/js/7.b183d4f7.js"><link rel="prefetch" href="/docs/assets/js/8.c5f5de09.js"><link rel="prefetch" href="/docs/assets/js/9.3de77086.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.94ae1aad.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Ynet-H5平台框架</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/start/desc.html" class="nav-link">
  起步
</a></div><div class="nav-item"><a href="/docs/qa/qa.html" class="nav-link">
  常见问题
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/start/desc.html" class="nav-link">
  起步
</a></div><div class="nav-item"><a href="/docs/qa/qa.html" class="nav-link">
  常见问题
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>起步</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/start/desc.html" class="sidebar-link">介绍</a></li><li><a href="/docs/start/guide.html" class="sidebar-link">起步</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/docs/start/core" class="sidebar-heading clickable open"><span>核心</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/start/router.html" class="sidebar-link">路由</a></li><li><a href="/docs/start/view.html" class="sidebar-link">视图</a></li><li><a href="/docs/start/request.html" aria-current="page" class="active sidebar-link">请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/start/request.html#api" class="sidebar-link">API</a></li><li class="sidebar-sub-header"><a href="/docs/start/request.html#请求公共配置项" class="sidebar-link">请求公共配置项</a></li><li class="sidebar-sub-header"><a href="/docs/start/request.html#使用方式" class="sidebar-link">使用方式</a></li><li class="sidebar-sub-header"><a href="/docs/start/request.html#两种方式" class="sidebar-link">两种方式</a></li><li class="sidebar-sub-header"><a href="/docs/start/request.html#注入" class="sidebar-link">注入</a></li></ul></li><li><a href="/docs/start/session.html" class="sidebar-link">会话缓存</a></li><li><a href="/docs/start/local.html" class="sidebar-link">持久化缓存</a></li><li><a href="/docs/start/log.html" class="sidebar-link">日志</a></li><li><a href="/docs/start/event.html" class="sidebar-link">事件</a></li><li><a href="/docs/start/DI.html" class="sidebar-link">依赖注入</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>插件</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="请求"><a href="#请求" class="header-anchor">#</a> 请求</h1> <p>请求管理用于实现渠道端向后台请求数据，实现业务数据的传递。</p> <h2 id="api"><a href="#api" class="header-anchor">#</a> API</h2> <table><thead><tr><th>方法</th> <th>方法说明</th> <th>参数</th> <th>参数说明</th> <th>返回值</th></tr></thead> <tbody><tr><td>request</td> <td>发送请求实际调用方法</td> <td>url: string<br>option: RequestConfig&lt;any, any&gt;</td> <td>url: 请求的路径<br>option: 请求的参数（格式详见下方RequestConfig格式）</td> <td>Promise</td></tr> <tr><td>service</td> <td>推荐使用的请求方式，详见下方使用方式</td> <td>service: { new (): IService&lt;I, O&gt; }<br>option: RequestConfig&lt;I, O&gt;</td> <td>service: 请求的对象（格式详见下方IService抽象类）<br>option: 请求的参数（格式详见下方RequestConfig格式）</td> <td>Promise</td></tr> <tr><td>cancelRequests</td> <td>取消请求</td> <td>forceCancelAll: boolean</td> <td>forceCancelAll: 是否全部取消请求，默认false</td> <td>无</td></tr></tbody></table> <p>RequestConfig格式：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">RequestConfig<span class="token operator">&lt;</span><span class="token constant">I</span><span class="token punctuation">,</span> <span class="token constant">O</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token comment">/**请求路径 */</span>
    url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token comment">/**请求类型 */</span>
    method<span class="token operator">?</span><span class="token operator">:</span>
        <span class="token operator">|</span> <span class="token string">&quot;get&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;GET&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;delete&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;DELETE&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;head&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;HEAD&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;options&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;OPTIONS&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;post&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;POST&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;put&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;PUT&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;patch&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;PATCH&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;purge&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;PURGE&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;link&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;LINK&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;unlink&quot;</span>
        <span class="token operator">|</span> <span class="token string">&quot;UNLINK&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">/**请求配置参数 */</span>
    data<span class="token operator">:</span> <span class="token constant">I</span><span class="token punctuation">;</span>
    <span class="token comment">/** 文件（文件上传相关） */</span>
    file<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token comment">/** 文件名称（文件上传相关） */</span>
    fileName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token comment">/**是否记录缓存 */</span>
    enableCache<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    <span class="token comment">/**缓存标识 */</span>
    cacheId<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token comment">/**缓存时间（单位：毫秒） */</span>
    cacheTimer<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token comment">/**httpHeader Http头*/</span>
    headers<span class="token operator">?</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token comment">/**路由跳转时保持请求 */</span>
    keepWhenRouting<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
    <span class="token comment">/** 成功请求 */</span>
    success<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>rspData<span class="token operator">:</span> <span class="token constant">O</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token comment">/** 请求失败 */</span>
    error<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> RequesterError<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Boolean <span class="token operator">|</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token comment">/**是否显示loading */</span>
    loading<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>IService抽象类：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">IService<span class="token operator">&lt;</span><span class="token constant">I</span><span class="token punctuation">,</span> <span class="token constant">O</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// 请求的路径</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    <span class="token comment">// 转换请求数据 需要返回处理后的数据</span>
    <span class="token keyword">public</span> <span class="token function">transfromReq</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token constant">I</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 转换响应数据，需要返回处理后的数据</span>
    <span class="token keyword">public</span> <span class="token function">transformRsp</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">O</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token constant">O</span><span class="token operator">&gt;</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="请求公共配置项"><a href="#请求公共配置项" class="header-anchor">#</a> 请求公共配置项</h2> <table><thead><tr><th>配置项</th> <th>配置项说明</th> <th>参数</th> <th>参数说明</th> <th>返回值</th></tr></thead> <tbody><tr><td>transformReqData</td> <td>公共转换请求数据方法</td> <td>data: any<br>config: RequestConfig&lt;any, any&gt;</td> <td>data: 请求数据<br>config: 配置信息（RequestConfig格式）</td> <td>处理后的数据data</td></tr> <tr><td>transformRspData</td> <td>公共转换响应数据方法</td> <td>data: any<br>config: RequestConfig&lt;any, any&gt;</td> <td>data: 请求数据<br>config: 配置信息（RequestConfig格式）</td> <td>处理后的数据data</td></tr> <tr><td>getRequestHandler</td> <td>获取请求触发器</td> <td>config: RequestConfig&lt;any, any&gt;</td> <td>config: 配置信息（RequestConfig格式）</td> <td>请求触发器（详见下面使用说明）</td></tr> <tr><td>defaultErrorFunc</td> <td>公共错误处理函数</td> <td>err: RequesterError</td> <td>err: 错误对象信息（见下方RequesterError格式）</td> <td>无</td></tr> <tr><td>analyResult</td> <td>解析函数</td> <td>content: any<br>success: (data: any) =&gt; void<br>error: (err: RequesterError, extendData: { [key: string]: any }) =&gt; void<br>option?: RequestConfig&lt;any, any&gt;</td> <td>content: any<br>success:  成功函数<br>error:  错误函数<br>option?:  配置信息（RequestConfig格式）</td> <td>无</td></tr></tbody></table> <p>RequesterError格式：</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>
<span class="token comment">/**
 * 规范请求报错信息
 */</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">RequesterError</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    code<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
    message<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h2> <p><strong>1.引入</strong></p> <p>首先确保已经引入依赖项@ynet/core及@ynet/request-axios（XHR请求），@ynet/request-mock（mock请求），如果不需要mock的话可以忽略@ynet/request-mock；</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// XHR请求</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RequestByAxios <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ynet/request-axios&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 请求配置类 需要实现</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RequesterConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ynet/core&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// mock 请求</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> RequestByMock <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ynet/request-mock&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们需要继承RequesterConfig实现它的方法，如图所示：</p> <p>1.getRequestHandler 方法必须返回一个请求触发器，实际开发中可以根据不同请求类型返回不同的触发器，该方法中//#if 判断条件 //#endif结束，这是使用了@ynet/if-loader，详情参见@ynet/if-loader插件。</p> <p>2.transformReqData 请求数据转换方法统一规范请求头及请求格式 最终返回处理好的data。</p> <p>3.analyResult 结果解析判断返回最终的结果是成功还是失败，并执行success或者error。</p> <p>4.defaultErrorFunc 默认错误处理函数，弹出错误提示或者根据自身业务来处理错误。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SelfRequestConfig</span> <span class="token keyword">extends</span> <span class="token class-name">RequesterConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//按实际情况进行方法重写，实现特殊化需求</span>
    <span class="token comment">/** 自定义获取请求触发器 */</span>
    <span class="token function">getRequestHandler</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//#if appConfig.globalDefine.ynet_process_request_type === &quot;axios&quot;</span>
        <span class="token comment">// TODO:(其他) 在这里可以设置请求上下文根</span>
        <span class="token comment">//config.url = &quot;xxx/&quot; + config.url;</span>
        <span class="token comment">//#endif</span>

        <span class="token comment">/**
         * 可根据不同的请求配置执行不同的请求处理逻辑
         * 例如：
         * a.do 使用mock
         * b.do 使用axios
         * ...
         */</span>

        <span class="token comment">//#if appConfig.globalDefine.ynet_process_request_type === &quot;mock&quot;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RequestByMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//#endif</span>

        <span class="token comment">//#if appConfig.globalDefine.ynet_process_request_type === &quot;axios&quot;</span>
        <span class="token comment">// eslint-disable-next-line no-unreachable</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RequestByAxios</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//#endif</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** 自定义请求数据转换方法 */</span>
    <span class="token keyword">async</span> <span class="token function">transformReqData</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 设置http 请求头</span>
        config<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>
            header<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            body<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span>data <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/** 请求结果分析 */</span>
    <span class="token function">analyResult</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> success<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//#if appConfig.globalDefine.ynet_process_request_type === &quot;mock&quot;</span>
        <span class="token function">success</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">//#endif</span>

        <span class="token comment">// eslint-disable-next-line no-unreachable</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">.</span>errorCode <span class="token operator">===</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">success</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                code<span class="token operator">:</span> content<span class="token punctuation">.</span>errorCode<span class="token punctuation">,</span>
                message<span class="token operator">:</span> content<span class="token punctuation">.</span>errorMsg
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 默认错误处理 </span>
    <span class="token function">defaultErrorFunc</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token operator">?.</span>message <span class="token operator">||</span> <span class="token string">&quot;请求出现错误，请您稍后再试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>依赖项导入完成，并且配置项处理完成，我们可以使用 <strong>service(推荐)</strong> 或者 request                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           发起请求</p> <h2 id="两种方式"><a href="#两种方式" class="header-anchor">#</a> 两种方式</h2> <p><em>1.service</em></p> <p>首先创建一个ts文件，一下简称demo.ts, 格式如下</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// 1.首先导入IService</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> IService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@ynet/core&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 2.配置接口中输入输出参数</span>
<span class="token comment">//输入参数</span>
<span class="token keyword">type</span> <span class="token class-name">Input</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//输出参数</span>
<span class="token keyword">type</span> <span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 3.继承实现IService</span>
<span class="token comment">/**
 * 功能名称：xxx
 * 作者：xxx
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Service</span> <span class="token keyword">extends</span> <span class="token class-name">IService<span class="token operator">&lt;</span>Input<span class="token punctuation">,</span> Output<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
    url <span class="token operator">=</span> <span class="token string">&quot;xxxx.do&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 一般的情况无需配置下面这两个转换函数</span>
    <span class="token keyword">public</span> <span class="token function">transfromReq</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">transformRsp</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">O</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token constant">O</span><span class="token operator">&gt;</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在视图中（*.vue）使用，注意 <strong>keepWhenRouting</strong>配置项，以下代码注释块中有说明</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 导入如上创建的ts文件</span>
<span class="token keyword">import</span> getBankFeatureList <span class="token keyword">from</span> <span class="token string">&quot;demo.ts&quot;</span>
<span class="token comment">// 其它配置项省略，假设在methods中写入了一个请求方法</span>
methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// data 上送的请求数据，success成功执行函数，error失败执行函数</span>
 		<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span>getBankFeatureList<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token comment">/**
             *  一般不需要配置此项目，默认为false,在路由跳转前当前处在队列中的请求会取消掉
             *  配置此项为true，则在路由跳转前不会取消请求
             */</span>
            keepWhenRouting：<span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token comment">// 请求上送的报文</span>
            data<span class="token operator">:</span> <span class="token punctuation">{</span>
                pageNo<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageNo<span class="token punctuation">,</span>
                pageSize<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 成功函数处理数据 注意如果想让this执行Vue实例，此处应用箭头函数</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rspData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>rspData<span class="token punctuation">.</span>financeProInfolist<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">callBack</span><span class="token punctuation">(</span><span class="token function">checkNotNextPage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pageNo<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pageSize<span class="token punctuation">,</span> 		                                      rspData<span class="token punctuation">.</span>totalNum<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">// 失败函数 注意如果想让this执行Vue实例，此处应用箭头函数</span>
            <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callBack</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 其它配置项参照 RequestConfig 格式</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>如果不在视图中使用，不建议使用如下模式，建议使用request函数</strong></p> <div class="language- extra-class"><pre class="language-text"><code>app.requester.service(class {
	url: &quot;**.do&quot;
},option)
</code></pre></div><p><em>2.request</em></p> <p>一般是在非视图文件中使用，如工具库utils</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 如下所示</span>
app<span class="token punctuation">.</span>requester<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;***.do&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 配置项参照 RequestConfig 格式</span>
    data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>                
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在视图（*.vue）中使用, <strong>推荐使用service</strong></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>例子<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'***.do'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token comment">// 配置项参照 RequestConfig 格式</span>
            data<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><em>3.mock</em></p> <p>创建mock文件夹，并在目录下创建index.js文件，文件内容格式如下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/*
 * 复杂项目，建议按功能拆分文件 如在当前目录user文件我们创建了一个index.js写入mock数据
 */</span>
<span class="token keyword">import</span> userMock form <span class="token string">'./user/index.js'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对应接口名字</span>
    <span class="token string">&quot;xxx.do&quot;</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// mock返回数据</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>userMock
<span class="token punctuation">}</span>

</code></pre></div><p>使用mock模式，在getRequestHandler 应返回mock请求触发器，参照该节 引入 介绍</p> <h2 id="注入"><a href="#注入" class="header-anchor">#</a> 注入</h2> <p>对外提供注入ID为：REQUESTERCONFIGINJECTTAGNAME</p> <p>配置项实现接口为：RequesterConfig</p> <p>请求类实现接口为：IRequest</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/start/view.html" class="prev">
        视图
      </a></span> <span class="next"><a href="/docs/start/session.html">
        会话缓存
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.a8b6816f.js" defer></script><script src="/docs/assets/js/2.9a338741.js" defer></script><script src="/docs/assets/js/36.75323e51.js" defer></script>
  </body>
</html>
